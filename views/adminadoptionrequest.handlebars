
<div class="admin-container">
  <aside class="sidebar">
    <div class="logo">
      <img src="/img/pusa.png" alt="DLSU PUSA Logo" />
    </div>
    <div>
    Welcome, {{user.name}}!
    </div>
    <nav class="sidebar-nav">
      <ul>
        <li class="active">
          <span class="icon"><img src="/img/requests.png" alt="Interview Icon" /></span>
          <span>Adoption interview requests</span>
        </li>
        <li>
          <a href="/admin/trainer-users">
            <span class="icon"><img src="/img/trainers.png" alt="Trainer Icon" /></span>
            <span>Trainer Users List</span>
          </a>
        </li>
        <li>
          <a href="/admin/volunteer-users">
            <span class="icon"><img src="/img/volunteers.png" alt="Volunteer Icon" /></span>
            <span>Volunteer Users List</span>
          </a>
        </li>
        <li>
          <a href="/admin/cats">
            <span class="icon"><img src="/img/cats.png" alt="Cat Icon" /></span>
            <span>Cats Listing</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>
  <main class="main-content">
    <section class="requests-section">
      <h2>Adoption Interview Requests</h2>
      <div class="search-bar">
        <img src="/img/search.png" alt="Search" class="search-icon" />
        <input type="text" placeholder="Search by ID No. or Volunteer Name" />
      </div>
      <table class="requests-table">
        <thead>
          <tr>
            <th>Application ID</th>
            <th>Applicant</th>
            <th>Cat</th>
            <th>Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#if applications}}
            {{#each applications}}
            <tr data-id="{{this._id}}">
              <td>{{this._id}}</td>
              <td>{{this.user_name}}</td>
              <td>{{this.cat_name}}</td>
              <td>{{this.application_date}}</td>
              <td class="status-cell">{{this.status}}</td>
              <td>
                <button class="btn accept" data-action="accept">Accept</button>
                <button class="btn deny" data-action="deny">Deny</button>
              </td>
            </tr>
            {{/each}}
          {{else}}
            <tr><td colspan="6" style="text-align:center;">No applications yet</td></tr>
          {{/if}}
        </tbody>
      </table>
    </section>
  </main>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.requests-table tbody tr').forEach(function(row){
    row.addEventListener('click', async function(e){
      const actionBtn = e.target.closest('button[data-action]');
      if (!actionBtn) return;
      const id = row.getAttribute('data-id');
      const action = actionBtn.getAttribute('data-action');
      const status = action === 'accept' ? 'Accepted' : 'Denied';
      try {
        const res = await fetch(`/adoption/applications/${id}/status`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status })
        });
        const data = await res.json();
        if (!res.ok) {
          alert(data.message || 'Failed to update status');
          return;
        }
        const statusCell = row.querySelector('.status-cell');
        if (statusCell) statusCell.textContent = data.application.status;
      } catch (err) {
        console.error(err);
        alert('Network error');
      }
    });
  });
});
</script>